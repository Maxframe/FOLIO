---
import { urlFor } from "../utils/urlForImage";
import { Image } from 'astro:assets';

export interface Props {
  source: string;
  cls?: string;
  alt?: string;
  w?:number;
  h?:number;
  fit?: 'clip' | 'crop' | 'fill' | 'fillmax' | 'max' | 'scale' | 'min'; /* More info: https://www.sanity.io/docs/image-urls#fit-45b29dc6f09f */
  loading?: 'eager' | 'lazy';
}

const { source, alt, cls, w, h, fit, loading } = Astro.props as Props;

const pattern = /^image-([a-f\d]+)-(\d+x\d+)-(\w+)$/
const decodeAssetId = id => {
  const [, assetId, dimensions, format] = pattern.exec(id)
  const [width, height] = dimensions.split("x").map(v => parseInt(v, 10))
  return {
    assetId,
    size: { width, height },
    format,
  }
}
const imageSize = decodeAssetId(source)

---

<Image class={cls} src={urlFor(source).auto("format").fit(fit ? fit : "clip").width(w).height(h).url()} width={w ? w : imageSize.size.width} height={h ? h : imageSize.size.height} draggable="false" alt={alt ? alt : ""} loading={loading} />

<style lang="scss">

</style>