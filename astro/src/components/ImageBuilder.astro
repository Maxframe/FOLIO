---
import { urlFor } from "../utils/urlForImage";
import { Image } from 'astro:assets';

export interface Props {
  source: string;
  cls?: string;
  alt?: string;
  w?:number;
  h?:number;
}

const { source, alt, cls, w, h } = Astro.props as Props;

const pattern = /^image-([a-f\d]+)-(\d+x\d+)-(\w+)$/
const decodeAssetId = id => {
  const [, assetId, dimensions, format] = pattern.exec(id)
  const [width, height] = dimensions.split("x").map(v => parseInt(v, 10))
  return {
    assetId,
    size: { width, height },
    format,
  }
}
const imageSize = decodeAssetId(source)

---

<Image class={cls} src={urlFor(source).auto("format").width(w).height(h).url()} width={w ? w : imageSize.size.width} height={h ? h : imageSize.size.height} draggable="false" alt={alt ? alt : ""} />

<style lang="scss">
    .thumbnail-image {
    object-fit: cover;
    height: 100%;
    width: 100%;
    transform: scale(1.01);
    transition: var(--card-transition);
    height: 13rem;
}
</style>