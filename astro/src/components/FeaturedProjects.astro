---
import { sanityClient } from "sanity:client";
import ImageBuilder from "./ImageBuilder.astro";

const fProjectsData =
  await sanityClient.fetch(`*[_type == 'projectsSection'][0]{
    heading,
    "slug": slug.current,
    projectsFeatured[]->{
        projectName,
        "slug": slug.current,
        "thumbnailImage": thumbnailImage.asset._ref,
        thumbAltText
    }  
}`);
---

<section class="project-section" id={fProjectsData.slug}>
  <h2 class="project-section-title">{fProjectsData.heading}</h2>
  <div class="projects-wrapper">
    {
      fProjectsData.projectsFeatured?.map((project: any) => (
        <div class="card">
          <a href={project.slug} class="card-link">
            <div class="image-wrapper">
              <ImageBuilder
                cls="thumbnail-image"
                source={project.thumbnailImage}
                alt={project.thumbAltText}
                w={900}
                h={400}
                loading="eager"
              />
            </div>
          </a>
          <h3 class="card-title">{project.projectName}</h3>
        </div>
      ))
    }
  </div>
</section>

<style lang="scss">
  .project-section {
    max-width: var(--content-w);
    margin: 0 auto;
    padding: 0 var(--content-px);
    margin-bottom: 10rem;
    .project-section-title {
      font-size: var(--step-3);
      padding-top: var(--nav-height);
      margin-top: calc(var(--nav-height) * -1);
      margin-bottom: 1rem;
      margin-left: 1rem;
      transition: color 200ms ease-out;
    }
  }

  .projects-wrapper {
    display: flex;
    flex-direction: column;
    gap: var(--card-gap);
    width: 100%;

    .card {
      position: relative;
      width: 100%;
      height: var(--card-h);

      &:hover > {
        .card-title {
          opacity: 1;
        }
        .card-link .image-wrapper {
          transform: translateX(calc(var(--card-offset) * -1));
        }
      }

      .card-link {
        position: absolute;
        width: 100%;
        height: 100%;

        .image-wrapper {
          border-radius: var(--card-radius);
          overflow: hidden;
          height: 100%;
          transition: var(--card-transition-time);
          outline: solid var(--stroke-w) var(--c-stroke);
          background-color: var(--c-stroke);
          box-shadow: 0px 6px 10px -8px black;
        }
      }
      .card-title {
        position: absolute;
        right: 0;
        bottom: 1rem;
        color: var(--c-card-text);
        background-color: var(--c-card-text-bg);
        padding: 1rem 1.4rem;
        margin: 0;
        border-radius: 999px;
        font-size: 1.2rem;
        text-align: center;
        z-index: 1;
        opacity: 0;
        font-weight: 700;
        border: solid var(--stroke-w) var(--c-stroke);

        backdrop-filter: blur(10px);
        transform: translateX(var(--card-offset));
        pointer-events: none;

        transition: opacity var(--card-transition-time);
      }
    }
  }

  @media only screen and (max-width: 800px) {
    .project-section .project-section-title {
      margin-left: 0;
    }

    .projects-wrapper .card > {
      .card-title {
        opacity: 1;
      }
      .card-link .image-wrapper {
        transform: translateX(calc(var(--card-offset) * -1));
      }
    }
  }
</style>
